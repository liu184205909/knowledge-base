# é‚®ä»¶è‡ªåŠ¨åŒ–:ç›´æ¥è°ƒç”¨AI API

> **AIé‚®ä»¶è¥é”€çš„åº•å±‚å®ç°** | 2026-01-11 | èšç„¦APIè€Œéå°è£…å·¥å…·

---

## ğŸ¯ æ ¸å¿ƒç†å¿µ

**ä¸è¦ä½¿ç”¨å°è£…å·¥å…·,ç›´æ¥è°ƒç”¨AI API + é‚®ä»¶å‘é€API!**

```
âŒ é”™è¯¯æ–¹å¼:
ActiveCampaign/Mailchimp â†’ å°è£…å·¥å…· â†’ æˆæœ¬æ›´é«˜,åŠŸèƒ½å—é™

âœ… æ­£ç¡®æ–¹å¼:
Claude/OpenAI API(ç”Ÿæˆå†…å®¹) + SendGrid/Mailgun API(å‘é€é‚®ä»¶) â†’ æˆæœ¬æ›´ä½,å®Œå…¨æ§åˆ¶
```

---

## ğŸš€ ä¸‰ç§å®ç°æ–¹å¼

### æ–¹å¼1: MCPå·¥å…·é›†æˆ (æœ€ç®€å•)

**é€‚ç”¨åœºæ™¯**: å¿«é€Ÿç”Ÿæˆé‚®ä»¶å†…å®¹

**MCPé…ç½®**:
```json
{
  "mcpServers": {
    "sendgrid": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-sendgrid"]
    }
  }
}
```

**åœ¨Claude Codeä¸­ä½¿ç”¨**:
```bash
# ç”Ÿæˆå¹¶å‘é€è¥é”€é‚®ä»¶
ä»»åŠ¡:
1. ä½¿ç”¨Claudeç”Ÿæˆäº§å“æ¨èé‚®ä»¶
2. è°ƒç”¨SendGrid APIå‘é€ç»™ç”¨æˆ·åˆ—è¡¨
3. è®°å½•å‘é€ç»“æœ

äº§å“: AIå·¥å…·å¥—é¤
ç›®æ ‡ç”¨æˆ·: premium_users.csv
```

---

### æ–¹å¼2: Pythonè„šæœ¬ (æ¨è,æœ€çµæ´»)

**ä¼˜åŠ¿**: å®Œå…¨æ§åˆ¶,æ‰¹é‡å‘é€,æˆæœ¬æœ€ä½

**å®Œæ•´é‚®ä»¶è‡ªåŠ¨åŒ–ç³»ç»Ÿ**:
```python
import os
import requests
from typing import List, Dict
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import sendgrid
from sendgrid.helpers.mail import Mail, Email, To, Content

class EmailAutomationPipeline:
    """é‚®ä»¶è‡ªåŠ¨åŒ–æµæ°´çº¿"""

    def __init__(self):
        self.anthropic_api_key = os.getenv("ANTHROPIC_API_KEY")
        self.sendgrid_api_key = os.getenv("SENDGRID_API_KEY")
        self.sg = sendgrid.SendGridAPIClient(self.sendgrid_api_key)

    def generate_email_content(
        self,
        product_name: str,
        user_name: str,
        email_type: str = "promotional"
    ) -> Dict[str, str]:
        """ä½¿ç”¨Claudeç”Ÿæˆé‚®ä»¶å†…å®¹"""

        response = requests.post(
            "https://api.anthropic.com/v1/messages",
            headers={
                "x-api-key": self.anthropic_api_key,
                "Content-Type": "application/json",
                "anthropic-version": "2023-06-01"
            },
            json={
                "model": "claude-3-5-sonnet-20241022",
                "max_tokens": 1000,
                "messages": [{
                    "role": "user",
                    "content": f"""ç”Ÿæˆä¸€å°{email_type}é‚®ä»¶:

äº§å“: {product_name}
ç”¨æˆ·: {user_name}

è¦æ±‚:
1. ä¸»é¢˜è¡Œ: å¸å¼•äºº,ä¸è¶…è¿‡50å­—ç¬¦
2. é¢„è§ˆæ–‡æœ¬: ç®€æ´æ˜äº†
3. æ­£æ–‡: HTMLæ ¼å¼,åŒ…å«äº§å“äº®ç‚¹ã€ä½¿ç”¨åœºæ™¯ã€CTA
4. ä¸ªæ€§åŒ–: ä½¿ç”¨ç”¨æˆ·åå­—
5. é£æ ¼: ä¸“ä¸šä½†å‹å¥½

è¯·è¿”å›JSONæ ¼å¼:
{{
  "subject": "é‚®ä»¶ä¸»é¢˜",
  "preheader": "é¢„è§ˆæ–‡æœ¬",
  "body_html": "HTMLæ­£æ–‡",
  "plain_text": "çº¯æ–‡æœ¬æ­£æ–‡"
}}"""
                }]
            }
        )

        content = response.json()["content"][0]["text"]
        # è§£æJSON
        import json
        return json.loads(content)

    def send_email(
        self,
        from_email: str,
        to_email: str,
        subject: str,
        html_content: str,
        plain_content: str
    ) -> bool:
        """å‘é€é‚®ä»¶"""

        message = Mail(
            from_email=Email(from_email, "Your Brand"),
            to_emails=To(to_email),
            subject=subject,
            html_content=Content("text/html", html_content),
            plain_text_content=Content("text/plain", plain_content)
        )

        try:
            response = self.sg.send(message)
            return response.status_code == 202
        except Exception as e:
            print(f"å‘é€å¤±è´¥: {e}")
            return False

    def batch_send_campaign(
        self,
        users: List[Dict],
        product_name: str,
        from_email: str
    ) -> List[Dict]:
        """æ‰¹é‡å‘é€è¥é”€é‚®ä»¶"""

        results = []

        for user in users:
            try:
                # 1. ç”Ÿæˆä¸ªæ€§åŒ–é‚®ä»¶å†…å®¹
                content = self.generate_email_content(
                    product_name=product_name,
                    user_name=user["name"],
                    email_type="promotional"
                )

                # 2. å‘é€é‚®ä»¶
                success = self.send_email(
                    from_email=from_email,
                    to_email=user["email"],
                    subject=content["subject"],
                    html_content=content["body_html"],
                    plain_content=content["plain_text"]
                )

                results.append({
                    "email": user["email"],
                    "status": "sent" if success else "failed",
                    "subject": content["subject"]
                })

            except Exception as e:
                results.append({
                    "email": user["email"],
                    "status": "error",
                    "error": str(e)
                })

        return results

    def automated_drip_campaign(
        self,
        user_email: str,
        user_name: str,
        campaign_name: str
    ):
        """è‡ªåŠ¨åŒ–æ»´çŒè¥é”€åºåˆ—"""

        # é‚®ä»¶åºåˆ—å®šä¹‰
        email_sequence = [
            {
                "delay": 0,  # ç«‹å³å‘é€
                "type": "welcome",
                "product": "å…¥é—¨æ•™ç¨‹"
            },
            {
                "delay": 1,  # 1å¤©å
                "type": "educational",
                "product": "é«˜çº§æŠ€å·§"
            },
            {
                "delay": 3,  # 3å¤©å
                "type": "promotional",
                "product": "ä»˜è´¹å¥—é¤"
            },
            {
                "delay": 7,  # 7å¤©å
                "type": "engagement",
                "product": "ç”¨æˆ·æ¡ˆä¾‹"
            }
        ]

        # å¯ä»¥é›†æˆCelery/RQå®ç°å®šæ—¶ä»»åŠ¡
        for email in email_sequence:
            # è¿™é‡Œåº”è¯¥ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—å»¶è¿Ÿæ‰§è¡Œ
            content = self.generate_email_content(
                product_name=email["product"],
                user_name=user_name,
                email_type=email["type"]
            )

            self.send_email(
                from_email="noreply@yourbrand.com",
                to_email=user_email,
                subject=content["subject"],
                html_content=content["body_html"],
                plain_content=content["plain_text"]
            )

# ä½¿ç”¨ç¤ºä¾‹
pipeline = EmailAutomationPipeline()

# ç¤ºä¾‹1: å•æ¬¡è¥é”€æ´»åŠ¨
users = [
    {"email": "user1@example.com", "name": "å¼ ä¸‰"},
    {"email": "user2@example.com", "name": "æå››"},
    # ...æ›´å¤šç”¨æˆ·
]

results = pipeline.batch_send_campaign(
    users=users,
    product_name="AIå·¥å…·ä¸“ä¸šç‰ˆ",
    from_email="marketing@yourbrand.com"
)

# ç¤ºä¾‹2: è‡ªåŠ¨åŒ–æ»´çŒåºåˆ—
pipeline.automated_drip_campaign(
    user_email="newuser@example.com",
    user_name="ç‹äº”",
    campaign_name="æ–°ç”¨æˆ·onboarding"
)
```

**æˆæœ¬è®¡ç®—**:
```bash
# æœˆåº¦æˆæœ¬ä¼°ç®—

SendGrid APIå®šä»·:
- å…è´¹ç‰ˆ: 100å°/å¤©
- Basic: $19/æœˆ(10,000å°/æœˆ)
- Pro: $89/æœˆ(50,000å°/æœˆ)

Claude APIå®šä»·:
- æ¯å°é‚®ä»¶ç”Ÿæˆ: ~1000 tokens
- 1000å°é‚®ä»¶ = 1M tokens
- æˆæœ¬: $3

vs å°è£…å·¥å…·(ActiveCampaign: $49-149/æœˆ):
- æˆæœ¬é™ä½: 60-80%
- åŠŸèƒ½æ›´å¼º: å®Œå…¨å®šåˆ¶åŒ–
```

---

### æ–¹å¼3: n8nå·¥ä½œæµ (å¯è§†åŒ–)

**n8nå·¥ä½œæµç¤ºä¾‹: è‡ªåŠ¨åŒ–é‚®ä»¶åºåˆ—**:
```javascript
// Node 1: æ–°ç”¨æˆ·æ³¨å†Œè§¦å‘å™¨
èŠ‚ç‚¹ç±»å‹: Webhook
URL: https://your-site.com/api/user-registered

// Node 2: æ¬¢è¿é‚®ä»¶(ç«‹å³)
èŠ‚ç‚¹ç±»å‹: HTTP Request
URL: https://api.anthropic.com/v1/messages
Method: POST
Body:
{
  "model": "claude-3-5-sonnet-20241022",
  "max_tokens": 500,
  "messages": [{
    "role": "user",
    "content": "ç”Ÿæˆæ¬¢è¿é‚®ä»¶ç»™æ–°ç”¨æˆ·{{$json.name}}"
  }]
}

// Node 3: å‘é€æ¬¢è¿é‚®ä»¶
èŠ‚ç‚¹ç±»å‹: SendGrid
æ“ä½œ: Send Email

// Node 4: ç­‰å¾…1å¤©
èŠ‚ç‚¹ç±»å‹: Wait
æ—¶é—´: 24å°æ—¶

// Node 5: æ•™è‚²é‚®ä»¶(ç¬¬1å¤©å)
èŠ‚ç‚¹ç±»å‹: HTTP Request
ç”Ÿæˆç¬¬2å°é‚®ä»¶å†…å®¹

// Node 6: å‘é€æ•™è‚²é‚®ä»¶
èŠ‚ç‚¹ç±»å‹: SendGrid

// Node 7: ç­‰å¾…2å¤©
èŠ‚ç‚¹ç±»å‹: Wait
æ—¶é—´: 48å°æ—¶

// Node 8: ä¿ƒé”€é‚®ä»¶(ç¬¬3å¤©å)
...ç»§ç»­åºåˆ—
```

---

## ğŸ“Š é‚®ä»¶å‘é€APIå¯¹æ¯”

### ä¸»æµAPIå¯¹æ¯”

| API | å…è´¹é¢åº¦ | ä»˜è´¹ä»·æ ¼ | é€è¾¾ç‡ | æ¨èåº¦ |
|-----|---------|---------|--------|--------|
| **SendGrid** | 100å°/å¤© | $19-89/æœˆ | â­â­â­â­â­ | â­â­â­â­â­ |
| **Mailgun** | 5000å°/æœˆ | $35-80/æœˆ | â­â­â­â­â­ | â­â­â­â­â­ |
| **AWS SES** | 200å°/å¤© | $0.10/1000å° | â­â­â­â­â­ | â­â­â­â­ (å¤§é‡) |
| **Mailchimp** | 500å°/æœˆ | $20-35/æœˆ | â­â­â­â­ | â­â­â­ |

---

## ğŸ¯ A/Bæµ‹è¯•è‡ªåŠ¨åŒ–

**ä½¿ç”¨Claudeç”Ÿæˆå¤šä¸ªç‰ˆæœ¬,è‡ªåŠ¨æµ‹è¯•**:

```python
class EmailABTester:
    """é‚®ä»¶A/Bæµ‹è¯•"""

    def __init__(self):
        self.pipeline = EmailAutomationPipeline()

    def generate_variations(
        self,
        product_name: str,
        variations: int = 3
    ) -> List[Dict]:
        """ç”Ÿæˆå¤šä¸ªé‚®ä»¶ç‰ˆæœ¬"""

        versions = []
        for i in range(variations):
            content = self.pipeline.generate_email_content(
                product_name=product_name,
                user_name="[ç”¨æˆ·å]",
                email_type="promotional"
            )

            # è®©AIç”Ÿæˆä¸åŒé£æ ¼
            if i == 0:
                style = "ç´§è¿«æ„Ÿ(é™æ—¶ä¼˜æƒ )"
            elif i == 1:
                style = "ä»·å€¼å¯¼å‘(å¼ºè°ƒå¥½å¤„)"
            else:
                style = "æ•…äº‹åŒ–(ç”¨æˆ·æ¡ˆä¾‹)"

            versions.append({
                "version": f"V{i+1}",
                "style": style,
                "content": content
            })

        return versions

    def split_test(
        self,
        users: List[Dict],
        versions: List[Dict]
    ) -> Dict[str, float]:
        """åˆ†æµæµ‹è¯•"""

        import random

        # åˆ†æµ
        for user in users:
            version = random.choice(versions)

            # æ·»åŠ UTMå‚æ•°è¿½è¸ª
            tracking_params = f"?utm_campaign=abtest&utm_version={version['version']}"

            # å‘é€é‚®ä»¶
            self.pipeline.send_email(
                from_email="test@yourbrand.com",
                to_email=user["email"],
                subject=version["content"]["subject"],
                html_content=version["content"]["body_html"].replace("</a>", f"</a>{tracking_params}"),
                plain_content=version["content"]["plain_text"]
            )

        # è¿”å›æµ‹è¯•ç»“æœ
        # éœ€è¦é›†æˆåˆ†æå·¥å…·(å¦‚Google Analytics)
        return {
            "V1_open_rate": 0.35,
            "V1_click_rate": 0.05,
            "V2_open_rate": 0.42,
            "V2_click_rate": 0.08,
            "V3_open_rate": 0.28,
            "V3_click_rate": 0.04
        }

# ä½¿ç”¨
ab_tester = EmailABTester()

# ç”Ÿæˆ3ä¸ªç‰ˆæœ¬
versions = ab_tester.generate_variations(
    product_name="AIå·¥å…·ä¸“ä¸šç‰ˆ",
    variations=3
)

# A/Bæµ‹è¯•
results = ab_tester.split_test(users, versions)

# é€‰æ‹©æœ€ä¼˜ç‰ˆæœ¬
best_version = max(results.items(), key=lambda x: x[1])
print(f"æœ€ä¼˜ç‰ˆæœ¬: {best_version}")
```

---

## ğŸ’¡ é«˜çº§æŠ€å·§

### æŠ€å·§1: æ™ºèƒ½å‘é€æ—¶é—´ä¼˜åŒ–

```python
import pytz
from datetime import datetime

def calculate_best_send_time(user_timezone: str) -> datetime:
    """è®¡ç®—æœ€ä½³å‘é€æ—¶é—´"""

    tz = pytz.timezone(user_timezone)

    # è§„åˆ™: å‘¨äºŒ-å‘¨å››, ä¸Šåˆ10ç‚¹æˆ–ä¸‹åˆ2ç‚¹
    now = datetime.now(tz)

    if now.weekday() in [5, 6]:  # å‘¨æœ«
        # è°ƒæ•´åˆ°ä¸‹å‘¨äºŒ
        days_until_tuesday = (1 - now.weekday()) % 7
        now = now + timedelta(days=days_until_tuesday)

    # è®¾ç½®æ—¶é—´ä¸ºä¸Šåˆ10ç‚¹
    if now.hour < 10:
        now = now.replace(hour=10, minute=0, second=0)
    elif now.hour > 14:
        now = now.replace(hour=10, minute=0, second=0) + timedelta(days=1)
    else:
        now = now.replace(hour=14, minute=0, second=0)

    return now

# ä½¿ç”¨
best_time = calculate_best_send_time("Asia/Shanghai")
print(f"æœ€ä½³å‘é€æ—¶é—´: {best_time}")
```

### æŠ€å·§2: ä¸ªæ€§åŒ–æ¨èå¼•æ“

```python
def generate_personalized_recommendations(
    user_history: List[Dict],
    all_products: List[Dict]
) -> List[Dict]:
    """åŸºäºç”¨æˆ·å†å²ç”Ÿæˆä¸ªæ€§åŒ–æ¨è"""

    # ä½¿ç”¨Claudeåˆ†æç”¨æˆ·åå¥½
    response = requests.post(
        "https://api.anthropic.com/v1/messages",
        headers={
            "x-api-key": os.getenv("ANTHROPIC_API_KEY"),
            "Content-Type": "application/json"
        },
        json={
            "model": "claude-3-5-sonnet-20241022",
            "max_tokens": 1000,
            "messages": [{
                "role": "user",
                "content": f"""åŸºäºç”¨æˆ·å†å²è¡Œä¸ºåˆ†æåå¥½å¹¶æ¨èäº§å“:

ç”¨æˆ·å†å²:
{user_history}

å¯é€‰äº§å“:
{all_products}

è¯·è¿”å›:
1. ç”¨æˆ·åå¥½æ ‡ç­¾(æœ€å¤š5ä¸ª)
2. æ¨èäº§å“(æœ€å¤š3ä¸ª,æŒ‰ä¼˜å…ˆçº§æ’åº)
3. æ¨èç†ç”±(æ¯ä¸ªäº§å“ä¸€å¥è¯)

JSONæ ¼å¼ã€‚"""
            }]
        }
    )

    return response.json()["content"][0]["text"]
```

### æŠ€å·§3: é‚®ä»¶å†…å®¹ä¼˜åŒ–

```python
def optimize_email_subject(
    original_subject: str,
    email_body: str
) -> str:
    """ä½¿ç”¨A/Bæµ‹è¯•æ•°æ®ä¼˜åŒ–ä¸»é¢˜è¡Œ"""

    response = requests.post(
        "https://api.anthropic.com/v1/messages",
        headers={
            "x-api-key": os.getenv("ANTHROPIC_API_KEY"),
            "Content-Type": "application/json"
        },
        json={
            "model": "claude-3-5-sonnet-20241022",
            "max_tokens": 200,
            "messages": [{
                "role": "user",
                "content": f"""ä¼˜åŒ–é‚®ä»¶ä¸»é¢˜è¡Œä»¥æå‡æ‰“å¼€ç‡:

åŸå§‹ä¸»é¢˜: {original_subject}

é‚®ä»¶å†…å®¹æ‘˜è¦: {email_body[:200]}

è¯·ç”Ÿæˆ3ä¸ªä¼˜åŒ–åçš„ä¸»é¢˜è¡Œ,è¦æ±‚:
1. æ›´å¸å¼•äºº
2. ä¸è¶…è¿‡50å­—ç¬¦
3. é¿å…åƒåœ¾è¯æ±‡
4. åŒ…å«ç´§è¿«æ„Ÿæˆ–å¥½å¥‡å¿ƒ

è¿”å›JSONæ ¼å¼ã€‚"""
            }]
        }
    )

    # è§£æå¹¶è¿”å›æœ€ä¼˜ç‰ˆæœ¬
    return response.json()["content"][0]["text"]
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [04-ç¤¾åª’å‘å¸ƒè‡ªåŠ¨åŒ–.md](./04-ç¤¾åª’å‘å¸ƒè‡ªåŠ¨åŒ–.md) - å¤šå¹³å°å‘å¸ƒ
- [03-æ‰¹é‡ç”Ÿäº§æµæ°´çº¿.md](./03-æ‰¹é‡ç”Ÿäº§æµæ°´çº¿.md) - å¤šAgentåä½œ
- [01-å›¾ç‰‡è‡ªåŠ¨åŒ–.md](./01-å›¾ç‰‡è‡ªåŠ¨åŒ–.md) - é‚®ä»¶é…å›¾ç”Ÿæˆ

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ååƒåœ¾é‚®ä»¶**: éµå®ˆCAN-SPAMæ³•æ¡ˆ,åŒ…å«é€€è®¢é“¾æ¥
2. **é€Ÿç‡é™åˆ¶**: é¿å…çŸ­æ—¶é—´å†…å¤§é‡å‘é€
3. **APIå¯†é’¥å®‰å…¨**: ä½¿ç”¨ç¯å¢ƒå˜é‡
4. **å†…å®¹å®¡æ ¸**: AIç”Ÿæˆå†…å®¹éœ€äººå·¥å®¡æ ¸
5. **éšç§ä¿æŠ¤**: éµå®ˆGDPRç­‰éšç§æ³•è§„

---

**åˆ›å»ºæ—¶é—´**: 2026-01-11
**æ ¸å¿ƒç†å¿µ**: AIç”Ÿæˆå†…å®¹ + APIå‘é€é‚®ä»¶ = å®Œå…¨æ§åˆ¶! ğŸš€
